(function(h){function d(a,b){for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e])}var f=h.document,a=function(){var a=f.documentElement,b="matches,matchesSelector,msMatchesSelector,mozMatchesSelector,webkitMatchesSelector,oMatchesSelector".split(/,/g),b=b.filter(function(b){return!!a[b]}),e=b[0];return function(a,c){return a[e](c)}}();d(h,{$:function(a){return[].slice.call(f.querySelectorAll(a),0)},$one:function(a){return f.querySelector(a)},$matches:a,$ancestor:function(c,b){for(;c;)if(c=c.parentNode,
a(c,b))return c;return null},$new:function(a,b){var e=f.createElement(a),d;for(d in b)b.hasOwnProperty(d)&&e.setAttribute(d,b[d]);return e},$text:function(a,b){a.innerHTML="";a.appendChild(f.createTextNode(b))},$formValues:function(a){function b(a,c){for(var e=a.firstChild;e;)e.hasAttribute&&e.hasAttribute("name")&&(c[e.name]=e.value),b(e,c),e=e.nextSibling}var e={};b(a,e);return e},$expand:d})})(window);(function(h){function d(a,c){a=a.toString();return a.length<c?Array(c-a.length+1).join("0")+a:a}var f=/^((\d)+:)?(([0-5]?\d):)([0-5]\d)$/;h.time={b:function(a,c){var b=a/3600|0;a-=3600*b;var e=a/60|0;a=a-60*e|0;return c||b?b+":"+d(e,2)+":"+d(a,2):d(e,2)+":"+d(a,2)},parse:function(a){if(a=a.match(f)){var c=0;a[1]&&(c+=3600*parseInt(a[2],10));c+=60*parseInt(a[4],10);return c+=parseInt(a[5],10)}return!1},k:function(a){a=a||new Date;return d(a.getFullYear(),4)+"-"+d(a.getMonth()+1,2)+"-"+d(a.getDate(),
2)}}})(window);(function(h){function d(a){this.i=a;this.items=[]}function f(a,c){var b=[];a.forEach(function(a){a=a.toString();-1==a.indexOf(c)&&-1==a.indexOf('"')?b.push(a):b.push('"'+a.replace(/"/g,'""')+'"')});return b.join(c)}d.autoCreate=function(a,c){if(a&&Array.isArray(a)&&0<a.length){var b=new d(c||a[0].getOwnPropertyNames());a.forEach(function(a){b.add(a)});return b}return null};d.prototype.add=function(a){this.items.push(a)};d.prototype.j=function(a,c){a=a||",";var b=[];c&&b.push(f(this.i,a));this.items.forEach(function(c){var d=
[];this.i.forEach(function(a){d.push(c[a])});b.push(f(d,a))}.bind(this));return b.join("\r\n")};d.prototype.saveAs=function(a,c,b){c=this.j(c,b);h.saveAs(new Blob(["\ufeff",c],{type:"text/csv"}),a)};h.Csv=d})(self||window);(function(){function h(){l&&window.clearTimeout(l);b&&b.c();var a=0;c.all.forEach(function(c){a+=c.a()});var g=$one("#projects #total .time");$text(g,time.b(a));g=Math.max(1E3-Date.now()%1E3,5);l=window.setTimeout(h,g)}function d(){var a=$new("LI",{id:"total"}),c=$new("A",{}),b=$new("HEADER",{}),m=$new("SPAN",{"class":"time"});$text(b,"Totalt:\u00a0");$text(m,"00:00");k.appendChild(a);a.appendChild(c);c.appendChild(b);c.appendChild(m)}function f(){b=null;c.all.forEach(function(a){a.stop()});localStorage.d=
a()}function a(){return JSON.stringify(c.all,function(a,c){if("name"==a||"totalFinishedTime"==a||"startedOn"==a||0<=a&&9999>=a)return c})}function c(b,g,d){this.name=b;this.totalFinishedTime=g;this.startedOn=d;c.all.push(this);this.id=c.all.length;d=this.f=$new("LI",{"class":this.startedOn?"running":""});null===k.firstChild?k.appendChild(d):k.insertBefore(d,k.lastChild);g=$new("A",{href:"#id"+this.id,"class":"activate"});d.appendChild(g);g["project-reference"]=this;g.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();this["project-reference"].g()},!1);d=$new("HEADER");$text(d,b);g.appendChild(d);b=$new("SPAN",{"class":"time"});$text(b,time.b(this.a()));g.appendChild(b);d=$new("A",{href:"#","class":"edit"});$text(d,"\u00c4ndra");g.appendChild(d);d.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();$ancestor(this,"a.activate")["project-reference"].h()},!1);b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();$ancestor(this,"a.activate")["project-reference"].h()},
!1);localStorage.d=a()}var b=null,e=null,l=null,k=$new("UL",{id:"projects"});d();c.prototype={c:function(){var a=this.f.querySelector("span.time");$text(a,time.b(this.a()))},a:function(){return this.startedOn?this.totalFinishedTime+(Date.now()-this.startedOn)/1E3|0:this.totalFinishedTime},start:function(){b&&b.stop();this.f.className="running";this.totalFinishedTime=this.a();this.startedOn=Date.now();this.c();b=this},stop:function(){this.f.className="";this.totalFinishedTime=this.a();this.startedOn=
null;this.c();b==this&&(b=null)},g:function(){this.start();localStorage.projects=a()},h:function(){b==this&&f();var a=time.b(this.totalFinishedTime,!0);e=this;$one("#timeTextBox").value=a;$one("#editTimeDialog").style.display="block"}};c.all=[];var n={removeAll:function(){window.confirm("Vill du verkligen RADERA alla projekt?")&&(c.all=[],b=null,k.innerHTML="",localStorage.d=a(),d())},clearAll:function(){window.confirm("Vill du verkligen nollst\u00e4lla alla klockor?")&&(b=null,c.all.forEach(function(a){a.stop();
a.totalFinishedTime=0;a.c()}),localStorage.d=a())},saveToCsv:function(){var a=[{name:"Projekt",time:"Tid"}];c.all.forEach(function(b){a.push({name:b.name,time:time.b(b.a())})});Csv.autoCreate(a,["name","time"]).saveAs("tajmkiper-"+time.k()+".csv",";",!1)},transfer:function(){$text($one("#transferInfo"),"V\u00e4nta lite...");var b=$one("#transferUrl");$text(b,"");b.href="";$one("#transferDialog").style.display="block";$one("#transferForm").classList.add("disabled");var c=new XMLHttpRequest;c.open("POST",
"/save");c.onload=function(){if(200==c.status){var a=c.responseText;$text($one("#transferInfo"),"Dina projekt har sparats p\u00e5 servern och kan plockas upp p\u00e5 den h\u00e4r adressen:");var b=$one("#transferUrl");$text(b,"tajmkiper.se/saved/"+a);b.href="http://tajmkiper.se/saved/"+a;$one("#transferUrlHidden").value=a;$one("#transferForm").classList.remove("disabled")}};c.onerror=function(){$text($one("#transferInfo"),"Ett fel intr\u00e4ffade n\u00e4r dina projekt skulle sparas.");window.setTimeout(function(){$one("#transferDialog").style.display=
"none"},3E3)};c.send("data="+encodeURIComponent(a()))}},p={addProjectDialog:function(a){$one("#nameTextBox").blur();(new c(a.name,0)).g()},editTimeDialog:function(b){b=time.parse(b.time);!1!==time&&(e.totalFinishedTime=b,e.c(),h(),localStorage.d=a())},transferDialog:function(a){localStorage.e=a.e;var b=new XMLHttpRequest;b.open("POST","/email-saved");b.send("email="+encodeURIComponent(a.e)+"&id="+encodeURIComponent(a.id))}};document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(k);
$(".modalDialogPanel").forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();a.target==this&&(this.style.display="none")},!0)});$(".modalDialogPanel > .actions > .closeModal > a").forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();$ancestor(this,".modalDialogPanel").style.display="none"},!1)});$(".modalDialogPanel > .actions > li[rel] > a").forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();
a=this.parentNode.getAttribute("rel");(0,n[a])();$ancestor(this,".modalDialogPanel").style.display="none"})});$(".modalDialogPanel form").forEach(function(a){a.addEventListener("submit",function(a){a.preventDefault();a.stopPropagation();$formValues(this)},!1)});$(".modalDialogPanel label").forEach(function(a){$one("#"+a.getAttribute("for")).setAttribute("placeholder",a.textContent)});$(".modalDialogPanel .buttons input").forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();var b=this.classList.contains("ok");this.classList.contains("cancel");var c=$ancestor(this,"form");a=c.parentNode;b&&(b=p[a.id],c=$formValues(c),b(c));a.style.display="none"},!1)});$one("#stopTimer").addEventListener("click",function(a){a.preventDefault();a.stopPropagation();f()},!1);$one("#addProject").addEventListener("click",function(a){a.preventDefault();a.stopPropagation();$one("#addProjectDialog").style.display="block";$one("#nameTextBox").value="";$one("#nameTextBox").focus()},
!1);$one("#settings").addEventListener("click",function(a){a.preventDefault();a.stopPropagation();$one("#settingsDialog").style.display="block"},!1);var b=localStorage.e;$one("#transferEmailTextBox").value=b||"";(b=localStorage.projects)||(b="[ ]");var d=[];try{d=JSON.parse(b)}catch(e){d=[]}Array.isArray(d)||(d=[]);c.all=[];d.forEach(function(a){a=new c(a.name,a.totalFinishedTime,a.startedOn);a.startedOn&&(a.stop(),a.start())});b=a();localStorage.projects=b;h()})})();